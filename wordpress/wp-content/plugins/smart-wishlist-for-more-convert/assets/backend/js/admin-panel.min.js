"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}jQuery(function(r){function n(e,t,a){r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:e,key:wlfmc_wishlist_admin.ajax_nonce,attachment_id:a.parent().find("input").val(),offset:t},method:"post",beforeSend:function(){a.addClass("loading")},success:function(t){t.success?(a.text(t.data.percentage+"%"),100<=parseInt(t.data.percentage)?setTimeout(function(){a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),o(t.data.message,"success")},2e3):n(e,parseInt(t.data.offset),a)):(a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),o(t.data.message,"error"))}}).fail(function(t){a.removeClass("loading"),window.console.log(t)})}function i(e,t,a){r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:e,key:wlfmc_wishlist_admin.ajax_nonce,offset:t},method:"post",beforeSend:function(){a.addClass("loading")},success:function(t){t.success?(a.text(t.data.percentage+"%"),100<=parseInt(t.data.percentage)?setTimeout(function(){a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),o(t.data.message,"success")},2e3):i(e,parseInt(t.data.offset),a)):(a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),o(t.data.message,"error"))}}).fail(function(t){a.removeClass("loading"),window.console.log(t)})}(function(){r("select#discount-type").on("change",function(){var t=r(this).val(),e=r("#coupon-amount");"percent"===t?(e.removeClass("wc_input_price").addClass("wc_input_decimal"),e.siblings(".description").text(wlfmc_wishlist_admin.i18n_percent_description)):(e.removeClass("wc_input_decimal").addClass("wc_input_price"),e.siblings(".description").text(wlfmc_wishlist_admin.i18n_amount_description))}).trigger("change")})();function e(a,t){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(!0,!0);t={action:t,key:wlfmc_wishlist_admin.ajax_nonce,options:r("form#wlfmc_automation_options_form").serialize()};r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:t,type:"POST",beforeSend:function(){a.addClass("loading")},complete:function(){a.removeClass("loading")},success:function(t){var e;!0===t.status?s(t.errors,"mct-updated"):!0===t.show_pro_popup?(e=a.data("modal"),r("#"+e).removeAttr("style").toggleClass("is-visible")):s(t.errors,"mct-error"),t.url&&""!==t.url&&(window.location.href=t.url)}})}r(document.body).on("click",".wlfmc-import-by-csv .mct_action_file_button",function(t){var e=r(this);return t.preventDefault(),n(e.closest(".wlfmc-import-by-csv").data("action"),0,e),!1}),r(document.body).on("click",".wlfmc-import-by-action",function(t){var e=r(this);return t.preventDefault(),i(e.data("action"),0,e),!1}),r(document.body).on("change",".wc_input_price[type=text], .wc_input_decimal[type=text]",function(){var t,e=wlfmc_wishlist_admin.decimal_point,a=(r(this).is(".wc_input_price")&&(e=wlfmc_wishlist_admin.mon_decimal_point),n=new RegExp("[^-0-9%\\"+e+"]+","gi"),t=new RegExp("\\"+e+"+","gi"),r(this).val()),n=a.replace(n,"").replace(t,e);a!==n&&r(this).val(n)}).on("keyup",".wc_input_price[type=text], .wc_input_decimal[type=text]",function(){var t,e=!1,a=r(this).is(".wc_input_price")?(e=!0,i=new RegExp("[^-0-9%\\"+wlfmc_wishlist_admin.mon_decimal_point+"]+","gi"),t=new RegExp("[^\\"+wlfmc_wishlist_admin.mon_decimal_point+"]","gi"),wlfmc_wishlist_admin.i18n_mon_decimal_error):(e=!0,i=new RegExp("[^-0-9%\\"+wlfmc_wishlist_admin.decimal_point+"]+","gi"),t=new RegExp("[^\\"+wlfmc_wishlist_admin.decimal_point+"]","gi"),wlfmc_wishlist_admin.i18n_decimal_error),n=r(this).val(),i=n.replace(i,"");n!==(i=e&&1<i.replace(t,"").length?i.replace(t,""):i)&&o(a,"warning")}),0<r("#enable_share_lists").length&&(r(document.body).on("change","#enable_share, #multi_list_enable_share",function(t){(r("#enable_share").is(":checked")||r("#multi_list_enable_share").is(":checked")?r("#enable_share_lists").val("1"):r("#enable_share_lists").val("0")).trigger("change")}),r("#enable_share, #multi_list_enable_share").trigger("change")),r(document.body).on("change","#sfl_enable",function(t){r(this).is(":checked")||"hidden"===r(this).attr("type")&&a(r(this).val())?(r("#merge_save_for_later").is(":checked")||r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#save-for-later']").show()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#save-for-later']").hide())}).trigger("change"),r(document.body).on("change","#merge_save_for_later",function(t){r("#sfl_enable").is(":checked")&&(r(this).is(":checked")?(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#text']")):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']"))).show()}).trigger("change"),r(document.body).on("change","#multi_list_enable",function(t){r(this).is(":checked")||"hidden"===r(this).attr("type")&&a(r(this).val())?(r("#merge_lists").is(":checked")||(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#lists']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#single-list']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").show()),r(".nav-tab-wrapper.mct-tabs a[href='#text']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#multi-list']").show()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#lists']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#single-list']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#multi-list']").hide())}).trigger("change"),r(document.body).on("change","#merge_lists",function(t){r("#multi_list_enable").is(":checked")&&(r(this).is(":checked")?(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#lists']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#single-list']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#lists']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#single-list']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").show()))}).trigger("change"),r(document.body).on("change","#wishlist_enable",function(t){r(this).is(":checked")||"hidden"===r(this).attr("type")&&a(r(this).val())?(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#wishlist']").show()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#wishlist']").hide())}).trigger("change"),r(document.body).on("change","#waitlist_enable",function(t){r(this).is(":checked")||"hidden"===r(this).attr("type")&&a(r(this).val())?(r(".nav-tab-wrapper.mct-tabs a[href='#waitlist']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").show(),r("#waitlist_lists_back-in-stock").is(":checked")&&r(".nav-tab-wrapper.mct-tabs a[href='#backinstock-box']").show()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#text']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#backinstock-box']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#waitlist']").hide())}).trigger("change"),r(document.body).on("change","#ask_for_estimate_enable",function(t){r(this).is(":checked")||"hidden"===r(this).attr("type")&&a(r(this).val())?(r(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#email']").show(),r(".nav-tab-wrapper.mct-tabs a[href='#ask-for-estimate']").show()):(r(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#email']").hide(),r(".nav-tab-wrapper.mct-tabs a[href='#ask-for-estimate']").hide())}).trigger("change"),r(document.body).on("change","#waitlist_lists_back-in-stock",function(t){r(this).is(":checked")?r(".nav-tab-wrapper.mct-tabs a[href='#backinstock-box']").show():r(".nav-tab-wrapper.mct-tabs a[href='#backinstock-box']").hide()}).trigger("change"),r(document.body).on("change","#waitlist_special_outofstock_box",function(t){r(this).is(":checked")||r("#waitlist_outofstock_button_loop").is(":checked")?r("#outofstock-box-popup").show():r("#outofstock-box-popup").hide()}).trigger("change"),r(document.body).on("change","#waitlist_outofstock_button_loop",function(t){r(this).is(":checked")||r("#waitlist_special_outofstock_box").is(":checked")?r("#outofstock-box-popup").show():r("#outofstock-box-popup").hide()}).trigger("change"),r(document.body).on("change","select#sfl_button_position",function(t){"with_remove_icon"===r(this).val()?(r("#sfl_button_type_text").attr("disabled",!0),r("#sfl_button_type_both").attr("disabled",!0),r("#sfl_button_type_icon").prop("checked",!0),r(".row-sfl_button_type").hide()):(r("#sfl_button_type_text").removeAttr("disabled"),r("#sfl_button_type_both").removeAttr("disabled"),r(".row-sfl_button_type").show())}),r(document.body).on("click",".wlfmc-built-wishlist-page:not(.disabled)",function(t){t.preventDefault();var e=r(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_wishlist_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),r(document.body).on("click",".wlfmc-built-waitlist-page:not(.disabled)",function(t){t.preventDefault();var e=r(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_waitlist_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),r(document.body).on("click",".wlfmc-built-lists-page:not(.disabled)",function(t){t.preventDefault();var e=r(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_lists_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),r(document.body).on("click",".wlfmc-built-tabbed-page:not(.disabled)",function(t){t.preventDefault();var e=r(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_tabbed_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),r(document).on("wlfmc_automation_init",function(){var t=r(this);t.on("click",".save-automation",function(t){return t.preventDefault(),e(r(this),"wlfmc_save_automation"),!1}),t.on("click",".new-automation",function(t){return t.preventDefault(),e(r(this),"wlfmc_new_automation"),!1}),t.on("change","form#wlfmc_automation_options_form :input",function(){r(".ajax-message-holder").html("")}),t.on("click",".wlfmc-send-offer-email-test",function(t){t.preventDefault();var e=r(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_sending),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{id:e.data("id"),automation_id:r("#automation_id").val(),action:"wlfmc_send_offer_email_test",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){var e;t&&t.message&&(e=t.success&&!0===t.success?"success":"error",o(t.message,e))},error:function(){console.log("We cant Send email. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),t.on("click",".wlfmc-reset-sending-cycles",function(t){t.preventDefault();var e=r(this),a=e.text();return confirm(wlfmc_wishlist_admin.i18n_resetting_confirm)&&(e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_resetting),r.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_reset_sending_cycles_automation",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){var e;t&&t.message&&(e=t.success&&!0===t.success?"success":"error",o(t.message,e))},error:function(){console.log("We cant Send email. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}})),!1})}).trigger("wlfmc_automation_init"),r(document).ready(function(t){var e;(e=t(".nav-tab-wrapper.mct-tabs .nav-tab:visible").first()).length&&t(".nav-tab-wrapper.mct-tabs .nav-tab-active:hidden").length&&e.trigger("click")});var l=null;function s(t,e){var a=r(".ajax-message-holder .mct-message"),n="";Array.isArray(t)?r.each(t,function(t,e){n+=""!==e?"<li>"+e+"</li>":""}):n+=""!==t?"<li>"+t+"</li>":"",""!==n&&(a.length||r(".ajax-message-holder").append('<div  class="mct-message '+e+'"><ul></ul></div>'),r(".ajax-message-holder .mct-message").find("ul").html(n),r("html, body").animate({scrollTop:0},"slow"))}function o(t,e){var a=document.getElementById("snackbar");a.innerHTML=t,a.className="show "+e,setTimeout(function(){a.className=a.className.replace("show","")},3e3)}function a(t){return!0===t||"yes"===t||"1"===t||1===t||"true"===t}r(document).on("change","#wlfmc_automation_options_form",function(t){t.preventDefault();var a,n,e,i,t=r(".preview_iframe_wrapper:visible"),s=r(".mail_heading:visible").val(),o=r("#mail-type").val(),c=r("#offer_emails .manage-row.is-current .wlfmc-send-offer-email-test").data("id");return void 0!==c&&(e="plain"===o?r(".text_content:visible").val():"undefined"!=typeof tinyMCE&&tinyMCE.get("offer_emails_"+c+"__html_content_")?tinyMCE.get("offer_emails_"+c+"__html_content_").getContent():r("#offer_emails_"+c+"__html_content_").val(),c="plain"===o?r(".text_footer:visible").val():"undefined"!=typeof tinyMCE&&tinyMCE.get("offer_emails_"+c+"__html_footer_")?tinyMCE.get("offer_emails_"+c+"__html_footer_").getContent():r("#offer_emails_"+c+"__html_footer_").val(),t.length&&(a=t,n=o,t=s,o=e,s=c,e=r(this),l&&l.abort(),i=new FormData,t={action:"wlfmc_preview_automation_template",key:wlfmc_wishlist_admin.ajax_nonce,template:n,heading:t,content:o,footer:s},(e||0<e.length)&&(i=new FormData(e.get(0))),r.each(t,function(t,e){i.append(t,"object"===_typeof(e)?JSON.stringify(e):e)}),l=r.ajax({url:wlfmc_wishlist_admin.ajax_url,contentType:!1,processData:!1,cache:!1,data:i,method:"POST",beforeSend:function(){a.closest(".mct-column").addClass("block-loading")},complete:function(){a.closest(".mct-column").removeClass("block-loading")},success:function(t){var t=t.data,e=a[0].contentDocument;e.open(),e.write(t.html),e.close(),"html"===n&&r(e).contents().find("#wrapper > table").removeAttr("height")}}))),!1}),r("#wlfmc_automation_options_form").length&&(setTimeout(function(){for(var t=tinymce.editors.length,e=0;e<t;e++)tinymce.editors[e].on("input-dirty keyup change",function(){r("#wlfmc_automation_options_form").trigger("change")})},2e3),r(document).on("changed-manage-item",function(t){r("#wlfmc_automation_options_form").trigger("change")}))});